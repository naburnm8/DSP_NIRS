# Программное устройство обработки аудиосигнала

## Инструкция:

### По запуску:
* Точка входа в программу расположена в классе ru.bmstu.naburnm8.dsp.playback.GUIPlayback метод main

* Точка входа в конвертер .mp3 файлов в тип, поддерживаемый программой, расположена в классе ru.bmstu.naburnm8.dsp.mp3converter.ConverterGUI метод main

### По замене фильтров:

Программа поддерживает два типа фильров: БИХ и КИХ.

Для файлов фильтров предусмотрено две директории:

* \src\main\resources\FIR - Для файлов КИХ фильтров
* \src\main\resources\IIR - Для файлов БИХ фильтров

Программа ожидает нахождение в этих папках по 10 файлов с именами: band0.fcf, band1.fcf, ..., band9.fcf

**В случае отличия количества этих файлов от 10 или ошибок при чтении программа не запустится!**



Пример файла фильтра для КИХ фильтра:

```% Generated by MATLAB(R) 24.1 and Signal Processing Toolbox 24.1.
% Generated on: 10-Feb-2025 02:49:52

% Coefficient Format: Decimal

% Discrete-Time FIR Filter (real)         
% -------------------------------         
% Filter Structure  : Direct-Form FIR     
% Filter Length     : 4001                
% Stable            : Yes                 
% Linear Phase      : Yes (Type 1)


Numerator:                                
0.000000070653177636656827608719277054872
...
```

Пример файла фильтра для БИХ фильтра:

```% Generated by MATLAB(R) 24.1 and Signal Processing Toolbox 24.1.
% Generated on: 10-Feb-2025 19:31:13

% Coefficient Format: Decimal

% Discrete-Time IIR Filter (real)          
% -------------------------------          
% Filter Structure    : Direct-Form II     
% Numerator Length    : 7                  
% Denominator Length  : 7                  
% Stable              : Yes                
% Linear Phase        : No                 

                                          
Numerator:                                 
 0.000018070816408928374441735312250223444 
...
Denominator:                               
  1                                        
 ...

```
Подробнее о возможном составе и генерации этих файлов в пункте Реализация.
## Задание:

Создать на высокоуровневом языке программирования цифровое устройство обработки аудиосигнала которое должно включать:

* Десятиполосный эквалайзер
* Реализация эффекта эхо
* Реализация эффекта вибрато

Типы фильтров:
* Основные: БИХ - Эллиптический
* Дополнительные: КИХ - Треугольное окно

## Реализация

### Общая информация

Приложение было разработано на языке Java. Для отрисовки UI использовалась библиотека SwingUI.

Приложение поддерживает 16-ти битные звуковые файлы без сжатия (.wav), для проигрывания отсчетов используется библиотека javax.sampled.

### Эффекты и фильтрация

Эффекты вибрато и эхо описаны в классе dsp.playback.RingBuffer. Для их применения используется кольцевой буфер, данные в который считываются из файла постепенно, каждый раз по 131072 байта, затем ко всем загруженным отсчетам применяются эффекты (если необходимо) и только после этого байты отправляются в API для проигрывания звука javax.sampled. Для эффекта эхо кольцевой буфер также хранит отсчеты прошлой загрузки.

Алгоритм фильтрации описан в этом же классе. Порядок действий фильтрации похож на применение эффектов, но в этом случае для свертки с импульсными характеристиками всех десяти полос используется многопоточность, на каждый из фильтров выделяется отдельный поток для улучшения производительности. Фильтры загружаются из файлов и не захардкожены.

### Парсинг фильтров

Для простоты замены фильтров был реализован класс, который считывает фильтры из файлов при каждом старте программы. Файлы .fcf фильтров напрямую экспортируются из matlab (fdatool), где они проектируются. Метод парсинга загружает данные только после строчек "Numerator:" или "Denominator:", т.е не учитывает строки с % вначале или пустые.

### Многопоточность

При исполнении программы возникает 3 основных потока:

* Поток UI - реакция на нажатие кнопок, изменение значений слайдеров
* Поток проигрывания - применение эффектов, фильтрации и вывод звука
* Поток БПФ - выполнение БПФ и перерерисовка графика

В потоке проигрывания также возникают потоки фильтрации, каждая полоса имеет свой поток для выполнения свертки.

